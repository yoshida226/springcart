<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="~{fragment :: meta}"></div>
    <div th:replace="~{fragment :: style}"></div>
	<title>商品管理</title>
</head>
<body class="d-flex flex-column min-vh-100">

	<div th:replace="~{fragment :: header}"></div>
	
	<div class="container mt-5">
	    <h2>商品管理</h2>
		
		<!-- ショップ切り替えタブ -->
		<ul class="nav nav-tabs springcart-shop-tabs mb-4">
		  <li class="nav-item" th:each="shop : ${shops}">
		    <a class="nav-link"
		       th:href="@{'/admin/products'(shopId=${shop.id})}"
		       th:classappend="${selectedShopId == shop.id} ? 'active' : ''"
		       th:text="${shop.name}">
		    </a>
		  </li>
		</ul>
	
	    <div>
	        <a>商品登録</a>
	    </div>
	
		<div th:each="product, iterStat : ${products}" class="mb-4 p-3 border rounded">
			<div class="d-flex justify-content-between align-items-center"
			     role="button"
			     style="cursor: pointer;"
			     data-bs-toggle="collapse"
			     th:attr="data-bs-target='#orderDetails__' + ${iterStat.index}"
			     th:attrappend="aria-controls='orderDetails__' + ${iterStat.index}">
			    
			    <div>
					<img th:src="@{/images/__${product.image}__}" class="springcart-img-preview mb-3" alt="商品画像">
					<h5 class="mb-1" th:text="${product.name}"></h5>
					<p class="mb-0" th:text="${'最終更新日: ' + #dates.format(product.update_date, 'yyyy/MM/dd HH:mm')}"></p>
			    </div>
			    
			    <i class="bi bi-chevron-down fs-3 text-secondary"
			       th:id="'icon-' + ${iterStat.index}"></i>
			</div>
	
		    <div th:id="'orderDetails__' + ${iterStat.index}" class="collapse mt-3">
		        <div th:each="detail : ${order.orderDetails}" class="d-flex align-items-start mb-2 pb-2 border-bottom small">
					<form th:action="@{/admin/products/save}" method="post" enctype="multipart/form-data">
			            <!-- 商品IDを隠しフィールドで渡す -->
			            <input type="hidden" th:name="id" th:value="${product.id}"/>
	
			            <div class="row">
			                <!-- 商品画像 -->
			                <div class="col-md-3 text-center">
			                    <img th:src="@{/images/__${product.image}__}" class="springcart-img-preview mb-3" alt="商品画像">
			                    <div>
			                        <input type="file" th:name="imageFile" class="form-control form-control-sm">
			                    </div>
			                </div>
	
			                <!-- 商品情報 -->
			                <div class="col-md-9">
			                    <div class="mb-3">
			                        <label class="springcart-label">商品名</label>
			                        <input type="text" th:name="name" th:value="${product.name}" class="form-control">
			                    </div>
			                    <div class="mb-3">
			                        <label class="springcart-label">カテゴリー</label>
			                        <input type="text" th:name="category" th:value="${product.category}" class="form-control">
			                    </div>
			                    <div class="mb-3">
			                        <label class="springcart-label">説明</label>
			                        <textarea th:name="description" class="form-control" rows="3" 
			                                  th:text="${product.description}"></textarea>
			                    </div>
			                    <div class="row">
			                        <div class="col-md-4 mb-3">
			                            <label class="springcart-label">価格 (¥)</label>
			                            <input type="number" th:name="price" th:value="${product.price}" class="form-control">
			                        </div>
			                        <div class="col-md-4 mb-3">
			                            <label class="springcart-label">在庫</label>
			                            <input type="number" th:name="stock" th:value="${product.stock}" class="form-control">
			                        </div>
			                    </div>
	
			                    <button type="submit" class="btn btn-primary springcart-save-btn">保存</button>
			                </div>
			            </div>
			        </form>
		        </div>
		    </div>
			
		</div>
	</div>
	
	<div th:replace="~{fragment :: footer}"></div>
	<div th:replace="~{fragment :: js}"></div>
	<script th:src="@{/js/history.js}"></script>
</body>
</html>